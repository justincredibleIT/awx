---
# Run kubectl/helm from this node (must be a k3s SERVER)
longhorn_runner_host: "{{ groups['k3s_servers'][0] }}"

# k3s kubeconfig on the server
longhorn_kubeconfig_path: "/etc/rancher/k3s/k3s.yaml"

# Namespace
longhorn_namespace: "longhorn-system"

# Helm install
longhorn_helm_repo_name: "longhorn"
longhorn_helm_repo_url: "https://charts.longhorn.io"
longhorn_release_name: "longhorn"
longhorn_chart_name: "longhorn/longhorn"
longhorn_chart_version: ""   # optional pin, else latest

# Optional Helm values dict (user-supplied). We will merge our worker-only selectors into this.
longhorn_helm_values: {}

# Wait timeouts
longhorn_wait_timeout: "15m"

# ----------------------------
# Workers-only policy settings
# ----------------------------

# Which nodes are "workers" for Longhorn storage scheduling
# Adjust this if your workers group is not k3s_agents
longhorn_worker_nodes: "{{ groups['k3s_agents'] | default([]) }}"
longhorn_controller_nodes: "{{ groups['k3s_servers'] | default([]) }}"

# Label key/value used to target workers
longhorn_worker_label_key: "node-role"
longhorn_worker_label_value: "worker"

# Automatically label worker nodes
longhorn_label_workers: true

# Enforce that Longhorn volume replicas schedule only on worker nodes
longhorn_storage_workers_only: true

# Prevent controllers from ever being used for Longhorn replica scheduling
longhorn_disable_scheduling_on_controllers: true

# Optional: force Longhorn system pods to run only on workers (manager/csi/ui)
# Storage scheduling restriction above is the critical part; this is optional.
longhorn_components_workers_only: true

# --------------------------------
# StorageClasses (optional)
# --------------------------------
longhorn_manage_storageclasses: true

# Create OUR OWN default storageclass (do not use "longhorn" - chart typically creates it)
longhorn_set_default_storageclass: true
longhorn_default_storageclass_name: "longhorn-rwo"

# If true, we will patch the chart-created "longhorn" SC to not be default (safe)
longhorn_unset_chart_default_storageclass: true
longhorn_chart_storageclass_name: "longhorn"

# Default SC parameters (2 replicas is typical for general workloads)
longhorn_default_replica_count: 1
longhorn_default_stale_replica_timeout: 30
longhorn_default_fs_type: "ext4"
longhorn_default_reclaim_policy: "Delete"
longhorn_default_volume_binding_mode: "Immediate"

# Optional HA StorageClass (3 replicas, good for important workloads like DBs)
longhorn_create_ha_storageclass: true
longhorn_ha_storageclass_name: "longhorn-ha-any"
longhorn_ha_replica_count: 2
longhorn_ha_stale_replica_timeout: 30
longhorn_ha_fs_type: "ext4"
longhorn_ha_reclaim_policy: "Delete"
longhorn_ha_volume_binding_mode: "Immediate"
