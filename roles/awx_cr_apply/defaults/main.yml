# Run kubectl from this node (must be a k3s SERVER)
awx_runner_host: "{{ groups['k3s_servers'][0] }}"

# Kubeconfig on that server
awx_kubeconfig_path: "/etc/rancher/k3s/k3s.yaml"

# Namespace where AWX will live
awx_namespace: "awx"

# AWX CR name
awx_name: "awx-server"

# Replicas for AWX web/task (match your HA env)
# awx_replicas: 3

# # Explicit web/task replica counts (match HA env)
# awx_web_replicas: 3
# awx_task_replicas: 3

# Service exposure
awx_service_type: "LoadBalancer"
awx_service_annotations: ""

# Optional requested MetalLB IP
awx_loadbalancer_ip: ""

# Admin user secret (optional)
awx_admin_password_secret: ""

# ---------------------------------------------------
# Database settings
# ---------------------------------------------------

# Use operator-managed postgres (dev/test only)
awx_manage_postgres: false

# Name of the postgres configuration secret referenced by the AWX CR
awx_postgres_configuration_secret: "awx-server-postgres-configuration"

# External DB connection inputs (used to create the configuration secret)
awx_external_db_host: "awxdb-ha-primary"
awx_external_db_port: 5432
awx_external_db_name: "awx"
awx_external_db_username: "awx"

# How the operator should treat the DB
awx_external_db_sslmode: "prefer"
awx_external_db_target_session_attrs: "read-write"
awx_external_db_type: "unmanaged"

# ---------------------------------------------------
# Persistence  (MATCH HA ENV)
# ---------------------------------------------------

# IMPORTANT: This avoids the Longhorn RWO multi-attach issue and matches your working HA cluster
# awx_projects_persistence: false

# (These are ignored when projects_persistence=false; keep only if you want parity with your HA CR output)
# awx_projects_storage_class: "longhorn-ha-any"
# awx_projects_storage_size: "10Gi"

# ---------------------------------------------------
# Topology spread (MATCH HA ENV)
# ---------------------------------------------------

awx_enable_topology_spread: true

# Use the same form your HA env shows (string block in CR)
awx_web_topology_spread_constraints: |
  - maxSkew: 1
    topologyKey: kubernetes.io/hostname
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: {{ awx_name }}-web

awx_task_topology_spread_constraints: |
  - maxSkew: 1
    topologyKey: kubernetes.io/hostname
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: {{ awx_name }}-task

# Optional extra settings
awx_extra_settings: []

# ---------------------------------------------------
# Wait settings
# ---------------------------------------------------

awx_wait_timeout: "20m"
awx_wait_ready: true

# --- RWO projects coordination (DISABLED; not needed when projects_persistence=false) ---
awx_pin_web_task_same_node: false

# If set, force web+task onto this node (unused when pinning disabled)
awx_pin_node_name: ""

# Node label key/value (unused when pinning disabled)
awx_pin_label_key: "awx-projects"
awx_pin_label_value: "rwo"